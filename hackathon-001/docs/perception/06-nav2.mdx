# Chapter 6: Introduction to Navigation 2 (Nav2) in ROS 2

Navigation 2 (Nav2) is the **next-generation navigation stack for ROS 2**.  
It enables robots to autonomously move from one location to another while avoiding obstacles in complex environments.

---

## 6.1 What is Nav2?

Nav2 provides:

- **Path Planning**: Calculate optimal routes from start to goal positions.  
- **Localization**: Track the robot's position using sensors and maps.  
- **Obstacle Avoidance**: Avoid static and dynamic obstacles.  
- **Behavior Trees**: Flexible execution of navigation behaviors.  

Nav2 is fully compatible with ROS 2 and supports modular, production-grade navigation.

---

## 6.2 Core Components

### 6.2.1 Map Server

- Stores static maps of the environment.  
- Publishes maps to other nodes for planning.

### 6.2.2 AMCL (Adaptive Monte Carlo Localization)

- Localizes the robot using particle filters.  
- Uses laser scans or camera data for accurate pose estimation.

### 6.2.3 Planner Server

- Computes global paths from start to goal.  
- Supports algorithms like A*, Theta*, and Dijkstra.

### 6.2.4 Controller Server

- Executes the path in real-time.  
- Uses local planners (e.g., DWB, MPC) to handle dynamic obstacles.

### 6.2.5 Behavior Tree Engine

- Orchestrates navigation tasks using behavior trees.  
- Allows modular and reusable behavior definitions.

---

## 6.3 Setting up Nav2 in ROS 2

1. **Install Nav2 packages**

```bash
sudo apt update
sudo apt install ros-humble-navigation2 ros-humble-nav2-bringup


# Launch a demo robot in Gazebo
export TURTLEBOT3_MODEL=burger
ros2 launch turtlebot3_gazebo turtlebot3_world.launch.py

# Launch Nav2
ros2 launch nav2_bringup tb3_simulation_launch.py

# Example Python client to send goals
import rclpy
from rclpy.node import Node
from geometry_msgs.msg import PoseStamped

class Nav2Client(Node):
    def __init__(self):
        super().__init__('nav2_client')
        self.publisher = self.create_publisher(PoseStamped, '/goal_pose', 10)

    def send_goal(self, x, y, theta=0.0):
        goal = PoseStamped()
        goal.header.frame_id = "map"
        goal.pose.position.x = x
        goal.pose.position.y = y
        goal.pose.orientation.z = theta
        self.publisher.publish(goal)
        self.get_logger().info(f"Goal sent: x={x}, y={y}, theta={theta}")

def main(args=None):
    rclpy.init(args=args)
    node = Nav2Client()
    node.send_goal(2.0, 3.0)
    rclpy.spin(node)
    node.destroy_node()
    rclpy.shutdown()

if __name__ == '__main__':
    main()
